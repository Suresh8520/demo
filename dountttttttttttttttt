stages:
  - stage: Download
    jobs:
      - job: DownloadJob
        steps:
          - powershell: |
              $repoUrl = 'https://github.source.internal.cba/ss99/powershell/archive/refs/heads/main.zip'
              $outputPath = 'C:\path\to\download\destination\main.zip'
              Invoke-WebRequest -Uri $repoUrl -OutFile $outputPath
            displayName: 'Download Git Repo'


AWSTemplateFormatVersion: '2010-09-09'
Description: CloudFormation template for setting up Windows instance with Git and Artifactory

Parameters:
  GitRepoURL:
    Type: String
    Description: URL of the Git repository
  ArtifactoryURL:
    Type: String
    Description: URL of Artifactory repository
  GitUsername:
    Type: String
    Description: Git username
  GitPassword:
    Type: String
    Description: Git password

    <powershell>
    # Install Git
    Install-PackageProvider -Name NuGet -Force -Scope CurrentUser
    Install-Module posh-git -Scope CurrentUser -Force
    Install-Git -Scope CurrentUser

    # Clone Git repository
    $repoURL = "${GitRepoURL}"
    $gitUsername = "${GitUsername}"
    $gitPassword = "${GitPassword}"
    git clone $repoURL -c "http.extraheader=Authorization: Basic $( [Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes("$($gitUsername):$($gitPassword)")))"
    </powershell>

$Username = "YourUsername"
$Password = ConvertTo-SecureString "YourPassword" -AsPlainText -Force
$Credential = New-Object System.Management.Automation.PSCredential($Username, $Password)

Start-Process -FilePath "path\to\file1.exe" -Credential $Credential -Wait
Start-Process -FilePath "path\to\file2.exe" -Credential $Credential -Wait
Start-Process -FilePath "path\to\file3.exe" -Credential $Credential -Wait

